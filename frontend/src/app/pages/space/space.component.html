<div class="space">
  <div class="communication-container" *ngIf="space && space.feedID">
    <div class="top">
     
      <div class="banner">
        <button *ngIf="hasEditRights()" class="round light img-edit-icon" (click)="imgEditReq()"><i class="ci-Image_02"></i></button>

        <input #imgInput type="file" accept="image/*" style="display:none" (change)="handle($event)">
        <img *ngIf="space && space.author && space.author.company && space.author.company.logo && space.author.company.logo.url" class="logo-img" src={{space.author.company_logo_url}} />

        <!-- <img *ngIf="!space.banner_url" class="banner-img" src="{{bannerURL}}"/> -->
        <img *ngIf="!space.banner_url" class="banner-img" src="{{bannerURL}}"/>
        <img *ngIf="space.banner_url" class="banner-img" [lazyLoad]="space.banner_url"/>

      </div>

      <div class="title-container">
        <span class="title-hint helperText" *ngIf="space && titleEditMode">Space Titel</span>
        <input
          class="title-input"
          #title
          *ngIf="space && titleEditMode"
          (keyup)="newTitle = title.value"
          (keyup.enter)="changeTitle()"
          value="{{space?.title}}"
        />
        <button class="rectangle dark navigationText title-save-button" *ngIf="space && titleEditMode" (click)="changeTitle()">Speichern</button>
        <!-- Title display mode -->
        <h3 [title]="space.title" class="headline s3 nomargin title" [class.grey]="!space.title" *ngIf="space && !titleEditMode" (click)="titleEditReq()">{{space?.title ? space.title : '- Kein Titel -'}}</h3>
        <button *ngIf="hasEditRights() && !titleEditMode" class="round light title-edit-icon" (click)="titleEditReq()"><i class="ci-Edit_Pencil_01"></i></button>
      </div>
  
      <div class="top-body" *ngIf="space.id !== -1">

        <div class="creator-container card no-shade" *ngIf="!space.author">
          <div class="feed-header-content">
            <span class="navigationText creator-name">Space Author not found</span>
          </div>
        </div>
  
        <div class="creator-container card no-shade"  *ngIf="space.author && space.author.name">
          <div class="user-avatar">
            <ho-avatar [avatarData]="space.author"></ho-avatar>
          </div>
          <div class="feed-header-content">
            <span class="helperText shared-from creator-name">Geteilt von</span>
            <span class="navigationText creator-name" style=" position: relative; ">{{space.author?.name}}</span>
            <span class="helperText">{{space.author?.position ? space.author?.position : 'no position known'}}</span>
          </div>
          <div class="icons-container">
            <i *ngIf="space.author?.email" class="ci-Mail" (click)="openMail(space.author?.email)"></i>
            <i *ngIf="space.author?.phone_number" class="ci-Phone" (click)="openTel(space.author?.phone_number)"></i>
            <i *ngIf="space.author?.calendar_link" class="ci-Calendar_Add" (click)="openLink(space.author?.calendar_link)"></i>
            <i *ngIf="space.author?.linkedin_link" class="ci-LinkedIn" (click)="openLink(space.author?.linkedin_link)"></i>
          <div *ngIf="space.author?.spreadly_link" class="spreadly-icon" (click)="openLink(space.author?.spreadly_link)"></div>
          </div>
        </div>
  
        <div class="posts-container">
          <div *ngFor="let post of posts; let i = index" class="space-post">
            <div class="post-author">
              <div class="post-author-avatar">
                <ho-avatar class="post-author-avatar" [avatarData]="post.author"></ho-avatar>
              </div>
              <div class="post-author-info">
                <span class="navigationText post-author-name">{{post.author?.name ? post.author?.name : '- No name given -'}}</span>
              </div>
              <i *ngIf="auth.isAuth() && (post.id_creator == auth.getUserID() || hasEditRights())" class="ci-More_Horizontal" (click)="openTextPostMenu(i)"> </i> 
              <div class="text-post-menu-container" style="position: absolute; z-index: 10;" *ngIf="textPostMenuIndex === i">
                <div class="edit-post-button helperText" style="z-index: 10;" (mousedown)="deleteTextPostReq(post.id)"> <i class="ci-Trash_Full"></i>Beitrag löschen</div>
              </div>
            </div>
            <p class="post-content" [innerHTML]="getContentHTML(post.content)"></p>
          </div>
          <div class="message-spacer"></div>
        </div>

        <div class="white-background"></div>

        <div class="post-comment-writer" *ngIf="spaceService.canPost()">
          <div class="send-icon paper-plane-icon" (click)="postComment()"></div>
          <textarea #commentWriterRef id="commentWriterRef" (keyup)="autogrow()" (keydown.enter)="onEnter($event)" (keydown.shift)="onShift()" (keyup.shift)="onUnShift()" class="comment-writer" placeholder="Dein Kommentar"></textarea>
        </div>

      </div>
    </div>
  
    <div class="bottom">
      <div class="page-title-container">
        <input
          class="page-title-input"
          #pageTitle
          *ngIf="space && pageTitleEditMode"
          (keyup)="newPageTitle = pageTitle.value"
          (keyup.enter)="changePageTitle()"
          value="{{space?.page_title}}"
        />
        <button class="rectangle dark navigationText page-title-save-button" *ngIf="space && pageTitleEditMode" (click)="changePageTitle()">Speichern</button>
        <!-- Title display mode -->
        <h5 [title]="space.title" class="headline s5 nomargin title" [class.grey]="!space.title" *ngIf="space && !pageTitleEditMode" (click)="editPageTitle()">{{space?.page_title ? space.page_title : 'Alles zum Deal'}}</h5>
      </div>

      <div class="pages-container">
        <div *ngFor="let page of space.pages; let i = index" class="space-page-item" [class.checked]="page.pageID === spaceService.pageUUIDSubject.value" (mouseup)="switchToSpacePage(page.pageID, $event)">
          <div class="left">

            <i [ngClass]="page.icon_link ? page.icon_link : 'ci-File_Blank'" [class.editable]="spaceService.currentUserHasEditRights()" [class.open]="iconsMenuUUID == page.pageID" (mouseup)="toggleIconMenu($event, page.pageID)"></i>

            <h5 class="headline s5 no-margin">{{page.name}}</h5>
          </div>
          <div class="icons-container" *ngIf="auth.isAuth() && hasEditRights()">
            <div class="switch-container" *ngIf="auth.isAuth() && space.id_creator === auth.getUserID()">
              <label class="switch" for="content">
                <input type="checkbox" id="content" [(ngModel)]="contentCheck" (click)="updateSpaceSubMenus()" onclick="return false" /> <!-- onclick="return false" -->
                <div class="slider round"></div>
              </label>
            </div>
            <i *ngIf="supportsPages()" class="ci-More_Horizontal" (mouseup)="openPagesMenu(page.pageID, $event)" [class.open]="pageUUIDMenu === page.pageID"></i>
            <div class="page-menu-container" [style]="pagesSubMenuStyle" *ngIf="pageUUIDMenu === page.pageID" [ngStyle]="pagesSubMenuStyle">
             
              <div *ngIf="space.id_creator === auth.getUserID()" class="page-menu-button helperText" style="z-index: 10;" (mousedown)="renamePage()">
                <i class="ci-Copy"></i> Umbenennen
              </div>
              <div *ngIf="space.id_creator === auth.getUserID()" class="page-menu-button helperText" style="z-index: 10;" (mousedown)="movePage(i, -1)">
                <i class="ci-Copy"></i> 1x hoch schieben
              </div>

              <div *ngIf="space.id_creator === auth.getUserID()" class="page-menu-button helperText" style="z-index: 10;" (mousedown)="movePage(i, 1)">
                <i class="ci-Copy"></i> 1x runter schieben
              </div>
              <div class="menu-item-line"></div>
              <div *ngIf="space.id_creator === auth.getUserID()" class="page-menu-button helperText" style="z-index: 10; color:#EA3737;" (mousedown)="deletePage(page.pageID)">
                <i class="ci-Trash_Full"></i> Seite löschen
              </div>

            </div>
          </div>
        </div>

        <div class="icons-menu-container" [ngStyle]="iconsMenuStyle" *ngIf="iconsMenuUUID">
          <div class="icon-item" *ngFor="let iconClass of iconsList" (mousedown)="changePageIcon(iconClass)">
            <i class="{{iconClass}}" [class.selected]="iconClass === currentIcon"></i>
          </div>
        </div>

      </div>

      <div *ngIf="auth.isAuth() && hasEditRights() && supportsPages()" class="page-adder-container">
        <button class="rectangle light navigationText page-creator" (click)="createPageReq()"> <i class="ci-Add_Plus"></i> Seite hinzufügen </button>
      </div>
    </div>

    <div class="watermark" style="word-wrap: break-word"  *ngIf="!auth.isAuth()">
      <div class="watermark-container" style="word-wrap: break-word" (click)="toHomePage()">
        <p class="watermark-text" style="word-wrap: break-word">like the content space? create yours with</p> <img class="watermark-logo" src="../../../assets/icons/corbado-logo-dark-blue2.png"/>
      </div>
    </div>
    
  </div>
  
  <div class="space-content-container" *ngIf="space && space.feedID">
    <div class="space-top-menu" *ngIf="auth.isAuth() && space.id_creator === auth.getUserID()">
      <div class="switch-container">
        <span class="helperText">Space online</span>
        <label class="switch" for="space-online">
          <input type="checkbox" id="space-online" [(ngModel)]="spaceOnline" onclick="return false"/>
          <div class="slider round"></div>
        </label>
      </div>
      <button class="round light users" (click)="openSideMenu('analytics')"><i class="ci-Chart_Line"></i></button>
      <button class="round light users" (click)="openSideMenu('settings')"><i class="ci-Settings"></i></button>
      <button class="rectangle dark navigationText space-share" (click)="shareSpace()"> <i class="ci-External_Link"></i> Space teilen </button>
    </div>
    <div class="space-top-menu" *ngIf="!auth.isAuth() || space.id_creator !== auth.getUserID()">
      <button class="round light users" (click)="shareSpace()"><i class="ci-External_Link"></i></button>
      <button class="rectangle light navigationText space-share" (click)="subscribeSpaceReq()"> <i class="ci-Calendar"></i> Subscribe Space </button>
    </div>

    <div class="space-page-container">
      
      <ho-space-page></ho-space-page>
    </div>    
       
    <div class="side-menu" [style]="sideMenuStyle">
      <i class="ci-Close_LG fa-2xl" (click)="closeSideMenu()"></i>
      <h4 class="headline s4 nomargin title"> {{sideMenuType === 'analytics' ? 'Space Analytics' : 'Space Settings'}} </h4>

      <div class="space-analytics-container" *ngIf="space && space.id_creator == auth.getUserID() && sideMenuType === 'analytics'">
        <div class="space-analytics card no-shade">
          <h4 class="analytics headline s4">Space Insights</h4>
          <div class="analytics-line">
            <i class="ci-Users_Group"></i>
            <div class="analytics-stat">
              <h3 class="analytics-stat headline s3">{{space.id_users_notifications?.length}}</h3>
              <!-- <p>Total Users</p> -->
              <p>Abonnenten</p>
            </div>
          </div>
          <div class="analytics-line">
            <i class="ci-Show"></i>
            <div class="analytics-stat">
              <h3 class="analytics-stat headline s3">{{space.view_count ? space.view_count : '0'}}</h3>
              <p>Guest Views</p>
            </div>
          </div>
          <div class="analytics-line">
            <i class="ci-Clock"></i>
            <div class="analytics-stat">
              <div class="analytics-stat"><span class="BETA-text">COMING SOON</span></div>
              <p>Zeit im Space</p>
            </div>
          </div>
        </div>
      </div>

      <div class="space-analytics-container" *ngIf="space && space.id_creator == auth.getUserID() && sideMenuType === 'settings'">
        <h5 class="headline s5 text">Allgemein</h5>
        <div class="feed-settings-container" *ngIf="space && space.id_creator === auth.getUserID()">
          <div class="setting-container card no-shade">
            <p class="rights-hint">Kommentare erlauben</p>
            <div class="switch-container">
              <label class="switch" for="checkboxRights">
                <input type="checkbox" id="checkboxRights" [(ngModel)]="spaceRightsCheck" (click)="changeSpaceRights()"/>
                <div class="slider round"></div>
              </label>
            </div>
          </div>

          <div class="setting-container card no-shade" [class.password]="spacePasswordCheck">
            <div class="password-check password-container">
              <p class="rights-hint">Space mit Passwort schützen</p>
              <div class="switch-container">
                <label class="switch" for="checkboxPassword">
                  <input type="checkbox" id="checkboxPassword" [(ngModel)]="spacePasswordCheck" (click)="changeSpacePassword()"/>
                  <div class="slider round"></div>
                </label>
        </div>
      </div>
            <div class="password-input password-container" *ngIf="spacePasswordCheck">
              <div class="input-box">
                <i *ngIf="!showPassword" class="ci-Hide password"></i> <input #password *ngIf="!showPassword" class="inputField" type="password" placeholder="" [(ngModel)]="passwordText"/>
                <i *ngIf="showPassword" class="ci-Show password"></i> <input #password *ngIf="showPassword"  class="inputField" type="text" placeholder="" [(ngModel)]="passwordText"/>
                <p class="show-password" *ngIf="!showPassword" (click)="showPassword = true;">show</p><p class="show-password" *ngIf="showPassword" (click)="showPassword = false;">hide</p>
              </div>
              <button class="rectangle dark navigationText" [class.invalid]="passwordText" (click)="changeSpacePassword()"> Set </button>
            </div>
          </div>
        </div>

        <h5 class="headline s5 text">Benachrichtungen</h5>
        <p>Für den Space haben folgende Adressen Notifications abonniert:</p>
        <div *ngFor="let email of space.emails_notifications" class="email">
          <p>{{email}} <i class="ci-Close_LG" (click)="removeMailFromNotification(email)"></i> </p>
        </div>
      </div>
    
    </div>
    
  </div>
</div>