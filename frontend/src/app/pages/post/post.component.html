<div class="post-container card">

  <div class="analytics" *ngIf="enableAnalytics && hasAnalytics">
    <i class="ci-Chart_Line"></i><p>{{numberOfViews}}x ge√∂ffnet</p>
  </div>

  <div class="post-header-container">
    <div class="user-avatar">
      <ho-avatar [avatarData]="post.author"></ho-avatar>
    </div>
    <div class="post-header-content">
      <span class="navigationText" [class.no-name]="!post.author?.name">{{post.author?.name ? post.author?.name : '-No name given by user-'}}</span>
      <span class="helperText timing">{{post.timestamp ? utils.getTimingText(post.timestamp) : 'just now'}}</span>
    </div>
    <div class="post-header-menu more-icon" style="z-index: 10;" (click)="openPostEditMenu(post.id)" [ngClass]="{'open': postEditIndex === post.id}" *ngIf="auth.isCurrentUser(post.id_creator)">
      <div class="post-menu-container" style="position: absolute; z-index: 10;" *ngIf="postEditIndex === post.id">
        <div class="edit-post-button helperText" style="z-index: 10;" (click)="editPostReq()"> <i class="ci-Edit_Pencil_01"></i> Beitrag bearbeiten</div>
        <div class="edit-post-button helperText" style="z-index: 10;" (click)="deletePostReq(post.id)"> <i class="ci-Trash_Full"></i> Beitrag l√∂schen</div>
        <!-- condition for analytics is same as for being abble to pin a post -->
        <div *ngIf="enableAnalytics" class="edit-post-button helperText" style="z-index: 10;" (click)="pinPostReq(post.id)"><i [ngClass]="post.pinned ? 'ci-Flag' : 'ci-Flag'"></i> {{ post.pinned ? 'Beitrag unpinnen' : 'Beitrag pinnen' }} </div>
        <div class="edit-post-button helperText" style="z-index: 10;" (click)="movePost(+1)"> <i class="ci-Arrow_Up_MD"></i> 1x hoch schieben</div>
        <div class="edit-post-button helperText" style="z-index: 10;" (click)="movePost(-1)"> <i class="ci-Arrow_Down_MD"></i> 1x runter schieben</div>
      </div>
    </div>
  </div>

  <div class="post-content-container">
    <p class="post-content" [innerHTML]="getContentHTML(post.content)"></p>
    <div class="post-links-container" *ngIf="post.links && post.links.length > 0">
      <div *ngFor="let link of post.links; let i = index">
        <ho-file-display [link]="link" (linkClicked)="onLinkClicked($event)"></ho-file-display>
      </div>
    </div>
    <div class="post-files-container" *ngIf="post.files && post.files.length > 0">
      <div *ngFor="let file of post.files; let i = index">
        <ho-file-display [fileData]="file"></ho-file-display>
      </div>
    </div>
  </div>

  <div class="post-footer-container">
    <div class="post-comments-container" *ngIf="post.comments && post.comments.length > 0">
      <div class="divider" [class.thin]="post.files && post.files.length > 0"></div>
      <!-- comments -->
      <div *ngFor="let comment of post.comments; let i = index">
        <div class="post-comment-container">
          <div class="post-header-container">
            <div class="user-avatar">
              <ho-avatar [avatarText]="comment.author?.name" [avatarData]="comment.author"></ho-avatar>
            </div>
            <div class="post-header-content">
              <span class="navigationText">{{comment.author?.name}}</span>
              <span class="helperText timing">{{comment.timestamp ? utils.getTimingText(comment.timestamp) : 'just now'}}</span>
            </div>
            <div class="post-header-menu more-icon" style="z-index: 10;" (click)="openPostEditMenu(comment.id)" *ngIf="auth.isCurrentUser(comment.id_creator)">
              <div class="post-menu-container" style="position: absolute; z-index: 10;" *ngIf="postEditIndex === comment.id">
                <div class="edit-post-button helperText" style="z-index: 10;" (click)="editCommentReq(comment.id)"> <i class="ci-Edit_Pencil_01"></i> Beitrag bearbeiten</div>
                <div class="edit-post-button helperText" style="z-index: 10;" (click)="deleteCommentReq(comment.id)"> <i class="ci-Trash_Full"></i> Beitrag l√∂schen</div>
              </div>
            </div>
          </div>
          <div class="post-content-container comment">
            <p class="post-content" [innerHTML]="getContentHTML(comment.content)"></p>
          </div>
        </div>
      </div>

    </div>

    <div class="post-comment-writer" *ngIf="canPost">
      <div class="reactions-container">
        <div class="reaction" [class.active]="hasReacted('like')" (click)="updateReactions('like')">
          <span class="reactions-icon helperText"> üôÇ{{post.reactions_json && post.reactions_json.like && post.reactions_json.like.length ? post.reactions_json.like.length : ''}}</span>
        </div>
        <div class="reaction last" [class.active]="hasReacted('celebrate')" (click)="updateReactions('celebrate')">
          <span class="reactions-icon helperText"> üëè{{(post.reactions_json && post.reactions_json.celebrate && post.reactions_json.celebrate.length) ? post.reactions_json.celebrate.length : ''}}</span>
        </div>
      </div>
      <div class="send-icon paper-plane-icon" (click)="postComment()"></div>
      <textarea #commentWriterRef class="comment-writer" placeholder="Dein Kommentar" (keyup)="autogrow()"></textarea>
    </div>

  </div>

</div>
